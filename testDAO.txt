package com.microshop.test;

import com.microshop.context.DBContext;
import com.microshop.dao.TaiKhoanDAO;
import com.microshop.dao.TaiKhoanFreeFireDAO;
import com.microshop.model.DanhMuc;
import com.microshop.model.TaiKhoan;
import com.microshop.model.TaiKhoanFreeFire;

import java.math.BigDecimal;
import java.sql.Connection;
import java.time.LocalDateTime;
import java.util.List;

public class testDAO {
    public static void main(String[] args) {
        try (Connection conn = DBContext.getConnection()) {
            System.out.println("‚úÖ K·∫øt n·ªëi th√†nh c√¥ng t·ªõi microShop!");
            TaiKhoanFreeFireDAO dao = new TaiKhoanFreeFireDAO();
            try {
                System.out.println("===== TEST DAO TAIKHOAN_FREEFIRE =====");
                //phai insert danhmuc trc do khoa phu cua taikhoan la danhmuc
                //INSERT INTO DANHMUC (MaDanhMuc, TenDanhMuc)
                //VALUES (1, 'Free Fire'),
                //       (2, 'Li√™n Qu√¢n'),
                //       (3, 'Riot');
                // 1Ô∏è‚É£ INSERT
                TaiKhoanFreeFire acc = new TaiKhoanFreeFire();
                acc.setMaDanhMuc(1); // danh m·ª•c Free Fire
                acc.setGiaGoc(new BigDecimal("100000"));
                acc.setGiaBan(new BigDecimal("150000"));
                acc.setTrangThai("DANG_BAN");
                acc.setDiemNoiBat("Acc test Free Fire full skin s√∫ng");
                acc.setLuotXem(10);
                acc.setThoiGianDang(LocalDateTime.now());
                acc.setTenDangNhap("test_freefire_acc");
                acc.setMatKhau("123456");
                acc.setCoTheVoCuc(true);
                acc.setSoSkinSung(99);
                acc.setHangRank("Huy·ªÅn Tho·∫°i");
                acc.setLoaiDangKy("Facebook");

                int idMoi = dao.insert(acc);
                System.out.println("‚úÖ ƒê√£ th√™m t√†i kho·∫£n Free Fire m·ªõi, ID = " + idMoi);

                // 2Ô∏è‚É£ GET BY ID
                TaiKhoanFreeFire found = dao.getById(idMoi);
                if (found != null) {
                    System.out.println("üîç L·∫•y theo ID: " + found.getMaTaiKhoan()
                            + " | Rank: " + found.getHangRank()
                            + " | ƒêƒÉng k√Ω: " + found.getLoaiDangKy());
                } else {
                    System.out.println("‚ùå Kh√¥ng t√¨m th·∫•y t√†i kho·∫£n v·ª´a th√™m!");
                }

                // 3Ô∏è‚É£ GET ALL
                List<TaiKhoanFreeFire> all = dao.getAll();
                System.out.println("üì¶ T·ªïng s·ªë t√†i kho·∫£n Free Fire trong DB: " + all.size());

                // 4Ô∏è‚É£ UPDATE
                if (found != null) {
                    found.setGiaBan(new BigDecimal("180000"));
                    found.setHangRank("Tinh Anh");
                    found.setTrangThai("DANG_BAN");
                    boolean updated = dao.update(found);
                    System.out.println(updated ? "‚úÖ C·∫≠p nh·∫≠t th√†nh c√¥ng!" : "‚ùå C·∫≠p nh·∫≠t th·∫•t b·∫°i!");

                    TaiKhoanFreeFire after = dao.getById(idMoi);
                    System.out.println("üîÅ Sau update: Rank = " + after.getHangRank()
                            + ", Gi√° b√°n m·ªõi = " + after.getGiaBan());
                }

                // 5Ô∏è‚É£ GET BY TRANG THAI
                List<TaiKhoanFreeFire> soldList = dao.getByTrangThai("DA_BAN");
                System.out.println("üü¢ C√≥ " + soldList.size() + " t√†i kho·∫£n c√≥ tr·∫°ng th√°i SOLD.");

                // 6Ô∏è‚É£ UPDATE TRANG THAI
                dao.updateTrangThai(idMoi, "DA_BAN");
                TaiKhoanFreeFire hidden = dao.getById(idMoi);
                System.out.println("üü° Tr·∫°ng th√°i sau updateTrangThai(): " + hidden.getTrangThai());

                // 7Ô∏è‚É£ DELETE
                boolean deleted = dao.delete(idMoi);
                System.out.println(deleted ? "üóëÔ∏è X√≥a th√†nh c√¥ng!" : "‚ùå X√≥a th·∫•t b·∫°i!");

                // 8Ô∏è‚É£ CHECK AGAIN
                TaiKhoanFreeFire check = dao.getById(idMoi);
                System.out.println(check == null ? "‚úÖ ƒê√£ x√≥a ho√†n to√†n kh·ªèi DB!" : "‚ö†Ô∏è V·∫´n c√≤n t·ªìn t·∫°i!");

                System.out.println("===== K·∫æT TH√öC TEST DAO TAIKHOAN_FREEFIRE =====");

            } catch (Exception e) {
                e.printStackTrace();
            }
        }
        catch (Exception e) {
            e.printStackTrace();
        }
    }
}
